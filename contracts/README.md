# VA Contract Tools

These are tools for processing and analyzing VA contracts.

## Usage: process_contracts.py

This script processes PDF contracts found in the `azure_pdfs` directory, extracts text, analyzes them using an LLM, and outputs the results to `contract_analysis.csv`.

**Basic Usage:**

```bash
python process_contracts.py
```

**Environment Variables:**

Make sure you have a `.env.local` file in the same directory with the necessary API keys:

*   `openai_api_key`: Your Azure OpenAI API key (used by default).
*   `openai_api_key_smart`: Your standard OpenAI API key (used with `--smart-mode`).

**Command-line Options:**

*   `--smart-mode`: Use the standard OpenAI client (`o3-mini` model) instead of the default Azure OpenAI client (`gpt-4o` model). Requires `openai_api_key_smart` to be set in `.env.local`.
*   `--second-pass-only`: Skip the initial data extraction (pass 1) and only perform the munchable analysis (pass 2) on existing results in `contract_analysis.csv`.
*   `--test-mode`: Run the script on a small batch of 3 files for testing purposes.
*   `--batch-size <NUMBER>`: Specify the number of contracts to process in each batch (default: 25).

**Example:**

Run in smart mode with a batch size of 10:

```bash
python process_contracts.py --smart-mode --batch-size 10
```

Run only the second pass analysis:

```bash
python process_contracts.py --second-pass-only
```

## Usage: analyze_contracts.py

This script reads the `contract_analysis.csv` file generated by `process_contracts.py`, cleans currency data, and performs analysis to calculate total contract values, FY25 values, and vendor rankings. It outputs the analysis both to the console and to a timestamped text file (e.g., `contract_analysis_YYYYMMDD_HHMMSS.txt`).

**Basic Usage:**

```bash
python analyze_contracts.py
```

The script reads `contract_analysis.csv` from the current directory and outputs the analysis file to the same directory. It first provides an analysis of all contracts and then a separate analysis for contracts marked as "munchable".

## Usage: push_to_iffy.py

This script extracts text from PDF files located in the `contracts/pdfs` directory and pushes the content to an IFFY API endpoint for moderation or processing.

**Setup:**

1.  **Environment Variables:** Create a `.env` file within the `contracts` directory. Add the following keys with your specific values:
    ```dotenv
    IFFY_API_URL="http://your-iffy-api-url/api/v1/moderate"
    IFFY_AUTH_TOKEN="iffy_YOUR_TOKEN_HERE"
    IFFY_CLIENT_ID="your_client_id_here"
    ```
2.  **Dependencies:** Install the required Python packages using the `requirements.txt` file located in the `contracts` directory:
    ```bash
    # Navigate to the contracts directory if you aren't already there
    cd contracts
    pip install -r requirements.txt
    ```
3.  **PDF Files:** Place the PDF files you want to process into the `contracts/pdfs` directory.

**Running the Script:**

Execute the script from within the `contracts` directory:

```bash
# Make sure you are in the contracts directory
python push_to_iffy.py
```

The script will iterate through each PDF in `contracts/pdfs`, extract its text content, and send a POST request to the configured IFFY API endpoint. Logs will indicate the progress and any errors encountered.
